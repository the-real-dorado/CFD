# Computational Fluid Dynamics package for Python

## Navier-Stokes equations  

The motion of an incompressible Newtonian fluid is described by
$$\nabla \cdot \vec{v} = 0$$  
$$\dfrac{\partial \vec{v}}{\partial t} + (\vec{v} \cdot \nabla)\vec{v} = -\dfrac{1}{\rho}\nabla p + \nu \nabla ^2 \vec{v} + \vec{g}$$  
In this package, a Poisson equation for the pressure field is used instead of the continuity equation  
$$\nabla ^2 p = -\rho \nabla \cdot (\vec{v} \cdot \nabla \vec{v})$$  
The equations are solved using finite-difference method.  

## Working

The package runs a `simulation` by applying the boundary conditions on the `fluid` object which is made using the `domain` function and solving the equations till convergence (steady state flow), then the `data` module is used to `export` or `plot` the velocity and pressure fields.

For domain mesh, .obj files are parsed. I use [Blender](https://www.blender.org/) for creating them. The package only solves in 2D; mesh must be in the XY-plane (Blender .obj export settings: "Forward: Y Forward", "Up: Z Up").  

## Dependencies

- [NumPy](https://numpy.org/)
- [Numba](http://numba.pydata.org/)
- [Matplotlib](https://matplotlib.org/)

## Usage

An [example](https://github.com/the-real-dorado/CFD/blob/main/CFD_example.ipynb) Jupyter notebook showing package usage is in the repository.  

As with any package that is not on `pip`, copy the package folder to the directory of the file to be used in, then import in file.

```python:
import CFD
```

To define domain and boundary conditions for fluid use the `domain` function which returns the necessary data for the `fluid` object.

```python:
domain = CFD.domain(file,dl,Nx,Ny,display=False)
```

Set `file` to path of .obj mesh of the complex domain (or `None`, for a simple rectangular domain) which has been discretized into `Nx` by `Ny` squares of side `dl`(=`dx`=`dy` in equations). The code parses empty space in the imported mesh file as obstructions with no-slip condition (sample [meshes](https://github.com/the-real-dorado/CFD/tree/main/meshes) are provided in repository). To check if mesh has been imported correctly, set `display` to `True` to render and view domain before simulation (does not change `data.plot` output, that always shows domain) where dark regions are regions set as obstructions.

The simulation results will be stored in a `fluid` object.

```python:
fluid = CFD.fluid(domain,rho=1,nu=0.1)
```

Boundary conditions are specific by a function with arguments `vx`, `vy`, `p`, `Nx`, and `Ny` which returns the set values of `vx`, `vy`, `p`, `gx` and `gy`; where arrays `vx`, `vy` are XY-components of velocity field $\vec{v}$, array `p` is pressure field $p$, and `gx`, `gy` are XY-components of the body acceleration $\vec{g}$ acting on entire domain.  

`models` module contains functions which will return the boundary condition function `bc`:

- `flow(domain,gx,gy)`
  - flow generated by constant $\vec{g}$ acting on entire domain
  - used to simulate pressure gradient-driven flow
  - domain unbounded in X and Y
  - uses complex domain
- `channel(gx)`
  - channel flow in X-direction with no-slip walls at `y=0` and `y=dl*Ny`
  - domain unbounded in X
  - uses simple rectangular domain
- `lid(vx)`
  - standard lid-driven cavity problem model
  - bounded domain
  - uses simple rectangular domain

```python:
bc = CFD.models.flow(domain,gx,gy)
```

`simulation` then solves the equations.

```python:
CFD.simulation(fluid,bc,delta=1e-3,dt=1e-6,iterations=1000)
```

`delta` is the target maximum fractional change in kinetic energy of fluid between iterations, `dt` is the time-step (used in equations), and `iterations` is the maximum number of iterations to solve for. Solver will run until convergence criteria is met (<`delta`) or enough iterations have been run (>`iterations`).

The `fluid` object will be updated after successful run.

`data` module is then used to handle the simulation results:

- `plot(fluid,plots=['velocity','streamlines'],path='',info=False)`
  - `plots` takes the data for a single plot (use `data.plot` again for different plot). Pass `velocity` or `pressure` for respective contours and (optionally) `streamlines` for overlaying streamlines (sample output [plots](https://github.com/the-real-dorado/CFD/tree/main/plots) are provided in repository).
  - Use `path` to change output file location in the file directory.
  - set `info` to `True` to plot scale and show title.
- `export(fluid,path='')`
  - Exports data to a `.csv` file.

```python:
CFD.data.plot(fluid,plots=['velocity','streamlines'],path='',info=False)
```
